<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Password Reset Portal</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto; padding: 20px; }
        .form-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; }
        input { width: 100%; padding: 8px; }
        button { padding: 10px 20px; background-color: #4CAF50; color: white; border: none; cursor: pointer; }
        button:hover { background-color: #45a049; }
        #message { margin-top: 10px; color: green; }
        #error { margin-top: 10px; color: red; }
    </style>
</head>
<body>
    <h2>Reset Your VM Password</h2>
    <form id="resetForm">
        <div class="form-group">
            <label for="vm_ip">VM IP Address:</label>
            <input type="text" id="vm_ip" name="vm_ip" required pattern="\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}" title="Enter a valid IP address (e.g., 192.168.1.1)">
        </div>
        <div class="form-group">
            <label for="username">Username:</label>
            <input type="text" id="username" name="username" required>
        </div>
        <div class="form-group">
            <label for="old_password">Old Password:</label>
            <input type="password" id="old_password" name="old_password" required>
        </div>
        <div class="form-group">
            <label for="new_password">New Password (min 8 characters):</label>
            <input type="password" id="new_password" name="new_password" required>
        </div>
        <button type="button" onclick="resetPassword()">Reset Password</button>
    </form>
    <div id="message"></div>
    <div id="error"></div>

    <script>
        function resetPassword() {
            const newPassword = document.getElementById('new_password').value;
            if (newPassword.length < 8) {
                document.getElementById('error').innerText = 'New password must be at least 8 characters long!';
                return;
            }
            
            const form = document.getElementById('resetForm');
            const formData = new FormData(form);
            fetch('/reset_password', {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                if (data.message) {
                    document.getElementById('message').innerText = data.message;
                    document.getElementById('error').innerText = '';
                } else {
                    document.getElementById('error').innerText = data.error || 'Old password incorrect or connection failed!';
                }
            });
        }
    </script>
</body>
</html>